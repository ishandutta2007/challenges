#!/usr/bin/env python

"""

Given a positive integer n output the integers a and b (forming reduced fraction a/b) such that:

ab=∏k=[1,n] (p^2_k-1)/(p^2_k+1)

Where p_k is the kth prime number (with p_1=2).

Examples:

1   -> 3, 5
2   -> 12, 25
3   -> 144, 325
4   -> 3456, 8125
5   -> 41472, 99125
15  -> 4506715396450638759507001344, 11179755611058498955501765625
420 -> very long

Probabilistic prime checks are allowed, and it's ok if your answer fails due to limitations in your language's integer type.

"""

from math import *

def eratosthenes(n):
    l = floor(sqrt(n))
    p = [False] * n
    for i in range(2, l+1):
        for j in range(i+i, n, i):
            p[j] = True

    r = []
    for i in range(2, n):
        if not p[i]:
            r.append(i)
    return r

def gcd(a, b):
    while b != 0:
        t = b
        b = a % b
        a = t
    return a

def prime_fraction(n):
    p = eratosthenes(n*n + 2)
    a = 1
    b = 1
    for k in range(1, n+1):
        a *= p[k-1]**2 - 1
        b *= p[k-1]**2 + 1
    d = gcd(a, b)
    return (a//d, b//d)

def main():
    assert(prime_fraction(1) == (3, 5))
    assert(prime_fraction(2) == (12, 25))
    assert(prime_fraction(3) == (144, 325))
    assert(prime_fraction(4) == (3456, 8125))
    assert(prime_fraction(5) == (41472, 99125))
    assert(prime_fraction(15) == (4506715396450638759507001344, 11179755611058498955501765625))
    assert(prime_fraction(420) == (236533725634243908071745606967955378699988462697191740307986057516088636969741798141866081922021292767222766086837551405957394025258666417926541568292420287231659649890999283464316507013216597903105898898291436860192348818736252065714969882829011636787364821125497139162107099644041576665000319644401210228761619704090059319646657646354135952615057168487160813700084288384462070330007106979202996363581816052029196231459847105536854670484323638897435972336706443049215496255867373973137154775539349759624414284525955986249060858529110233141392709423792333306127136478962481673031611564763068181666449558535504470835474975511414476467524171183559230194992217973527598045976853542656859659955589185217032410505201008784572208505261400609431191084356829443647916148547742703888125417678662689758148392833598202555324313668796910878577481917533774243392811229873073006538402023834730745867342324799355797702585604171284433177883858622333020008309008161807575908752577218977012511468321553178202413589345832340892617387702102672379316455331823783494123637220325081624545083116399386432245687256903946978740099912333653788545704345499632684570945375673472667004169097959354595038452211074073957019980696473816208172806079970160658141319004496509705473242034598658157982093823744694542474007156264626768607839002323500123912311942761134199333537937078894365329104559947132615074726974322082302611289300337424567203740092145731368650046152611441870099847190653130503100445952841424527020306899899047603424089669070885762097873350395194803764858104976519808017370614914633072783890097141462027745256710078464, 591289122719614308254621424796286891471975451623643741597931465302589033897563987677933159237964849059691039366992724687017336845819330640248552837331971844154416243084737454261077919463295377409969513959702859560492158767813031268944628701250989121751470524766445087044961910998590904302443094046304706005895668660102916705964029006920792910460149600000316327896455261731779143027201481271885564502114874960675602975707946254418425244441732668459046717763056124940739258529230193005982181008161183280960812027129381373226034114967592240399415576215883453851450391661305966709509417979743951530065411170478138728015238035055321835309087309561558474454930684792051482897395966331709265742328233805903659862848323810115517439126213744850179500904273735995540801215785266371773650695681871675569667544858928605089711591921897251262624573709139067571080510994435616029164227241945267794224729584153217669670370298894541593540767902998111388920063675886968701684444691887326950552417248835819804882400964349303358822457228967401585129948669124526176575119075114547820568529306702000697486835000898650227519527742191104548255102218943793194775864873990809105918731242065044021183880121108672337401118882283582131984638332821536990739901300962603702738857506031824327707235942344933995794342242063204183497127668801791866093681122251447934523634226372655123815245684007549158791170172597668316767358321565098790563870883673239067781711134571266859234435813783851200430467690359018742761011814369930985357057135887085358739746829488440494990900695951516133869893459760868297283905624729241950092315673828125))

main()
